# Loft Web Starter Project

A project boilerplate using [Next](https://nextjs.org/), [ReactJS](https://reactjs.org/), [Material UI](https://material-ui.com/ ), [TypeScript](https://www.typescriptlang.org/) and our design system [Copan](https://copan.loft.com.br/).

## Steps to install

1. Clone this repo
2. Run `nvm install` ([what is nvm?](https://github.com/nvm-sh/nvm))
3. Run `nvm use`
4. Run `npm install` - please, do not use `yarn` in this project!

## Running
```
npm run dev
```

## Components
We have [Plop](https://plopjs.com/documentation/) setup in the project, so you should be able to generate your component with a set of needed files, such as tests, styling and exports.

To do so, you can run:

```
plop YourComponent
```

And set the wrapper folder for the component. After that you'll have your component skeleton ready to add some logic/styles.

```sh
src/components/
├── YourComponent
  ├── YourComponent.component.tsx
  ├── YourComponent.spec.tsx
  ├── YourComponent.styles.tsx
  ├── index.ts
```

## Images
This project uses [Next Optimized Images](https://github.com/cyrilwanner/next-optimized-images) for ensuring better performance when using images.  
[You can read more on how to use it and its good practices here.](https://loftbr.atlassian.net/wiki/spaces/CRUX/pages/872644761/Otimiza+o+de+Imagens )

## Pixels
We use Heap as our default Analytics tool. Because of this, the `Heap` component is available at `src/components/Head/Heap`. In order to use it, simply set the environment variables for `NEXT_PUBLIC_HEAP_ID`. For development mode debugging, change the implementation in `src/pages/_document.tsx`. If you don't know what heap is, please refer to [this doc](https://loftbr.atlassian.net/wiki/spaces/PROD/pages/602832925/Heap) or reach out to #heap_help or #guild_frontend in slack.

## Testing

#### Unit tests

To run all tests:
```
npm t
```

To run in watch mode:
```
npm t -- --watch
```

To run a full coverage report:
```
npm run test:coverage
```

#### E2E tests

We use [cypress](https://docs.cypress.io/guides/getting-started/testing-your-app.html) for E2E testing.
For that, it is necessary that the server is up in the expected address (localhost:3000).

While iterating in development, the quickest approach is to run the server with `npm run dev`,
open cypress visual test runner with `npm run e2e:dev` and execute your test as many times as you want.

If you wish to run the full suite, Next.js dev mode could lead to some timeout errors,
since pages are compiled on-the-fly upon first access. To circumvent that, you can run
`npm run build && npm run start`, then ` npm run e2e:dev` and finally click to start the tests.

To run exactly as in our CI pipeline, `npm run e2e:ci` would do the magic.

## Setup

### Sonar

Add the SONAR_TOKEN variable to the repository. The token is unique to each repository and can
be generated by the Tech Lead or SEL of your team.

### Performance Metrics Dashboard

It is important to create the new project's dashboard in NewRelic to measure performance metrics.  
[You can read more about it and how to do so here.](https://loftbr.atlassian.net/wiki/spaces/CRUX/pages/815923250/Dashboard+de+M+tricas+de+Performance)

## Feature Requests & Suggestions

- Add Rollbar configuration
- Use internal Loft eslint lib
